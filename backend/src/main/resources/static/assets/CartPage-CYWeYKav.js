import{_ as V,r as _,i as B,s as m,o as u,c as d,a as t,l as F,v as N,b as n,w as i,k,F as x,n as E,t as f,p as y,x as T,g,f as q,d as v,q as M}from"./index-BJ4ajm9G.js";import{D as U}from"./DeliveryAndRefundSection-Dd5FBqyz.js";import{O as j}from"./OrderPricesSection-Bb_uSyBJ.js";import{A as h}from"./ActionButton-Tlu7xbmc.js";import{f as A}from"./format-B6-WTpBz.js";/* empty css                                                                     */const G={class:"cart-container"},H={class:"cart"},J={class:"cart__control"},K={colspan:"2"},Q={class:"table cart__table"},W={key:0,class:"text-center"},X={class:"text-center"},Y=["checked","onChange"],Z=["src"],ee={class:"text-muted prices"},te={class:"text-cross mr-2"},le={class:"fw-bold"},ae={class:"td-action"},oe={key:1},se={key:0},re={colspan:"7",class:"text-end fw-bold"},ne={class:"orders__action"},ce={__name:"CartPage",setup(ie){const o=_([]),c=B(),a=_(new Set),p=_(!0),b=T(),I=m(()=>o.value.filter(l=>a.value.has(l.productId)).reduce((l,e)=>l+e.originalPrice,0)),D=m(()=>o.value.filter(l=>a.value.has(l.productId)).reduce((l,e)=>{const r=e.originalPrice*e.discountRatePercentage/100;return l+r},0)),w=m(()=>o.value.filter(l=>a.value.has(l.productId)).reduce((l,e)=>{const r=e.originalPrice-e.originalPrice*e.discountRatePercentage/100;return l+r},0)),S=m(()=>o.value.length===0);(async()=>{try{const l=await g.get("/api/v1/cart");o.value=l.data,a.value=new Set(o.value.map(e=>e.productId))}catch(l){console.log("fetchCartProducts() err:",l)}})();const $=async l=>{try{const e=await g.delete(`/api/v1/cart/${l}`);o.value=o.value.filter(r=>r.productId!==l),a.value.delete(l),c.info("장바구니 목록에서 삭제 완료!")}catch(e){console.log("handleDeleteClick() err:",e),c.error("삭제 중 에러 발생!")}},R=()=>{p.value?a.value=new Set(o.value.map(l=>l.productId)):a.value.clear()},z=l=>{a.value.has(l)?(a.value.delete(l),p.value=!1):(a.value.add(l),p.value=a.value.size===o.value.length)},L=async()=>{if(a.value.size===0){c.warning("삭제할 상품을 선택해주세요");return}try{const l=Array.from(a.value);await g.delete("/api/v1/cart/bulk",{data:{productIds:l}}),o.value=o.value.filter(e=>!a.value.has(e.productId)),a.value.clear(),p.value=!1,c.info(`${l.length}개 상품이 장바구니 목록에서 삭제되었습니다`)}catch(l){console.log("handleCheckedDelete() err:",l),c.error("선택한 상품 삭제 중 에러가 발생했습니다!")}},C=async()=>{try{const l=Array.from(a.value),r=(await g.post("/api/v1/orders",{productIds:l})).data.id;c.success("주문 생성 성공!"),b.push(`/orders/${r}`)}catch{c.error("주문 생성 실패!")}},O=async l=>{console.log("구매하기",l);try{const r=(await g.post("/api/v1/orders",{productIds:[l]})).data.id;c.success("주문 생성 성공!"),b.push(`/orders/${r}`)}catch{c.error("주문 생성 실패!")}};return(l,e)=>{const r=q("RouterLink");return u(),d("div",G,[t("section",H,[e[11]||(e[11]=t("h1",{class:"mb-4"},"장바구니",-1)),t("div",J,[t("div",null,[F(t("input",{type:"checkbox",name:"all",id:"all","onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),onChange:R},null,544),[[N,p.value]])]),t("div",K,[e[3]||(e[3]=t("label",{for:"all"},"전체선택",-1)),n(h,{onAction:L,disabled:a.value.size===0,class:"btn-select"},{default:i(()=>e[1]||(e[1]=[v(" 선택삭제 ")])),_:1},8,["disabled"]),n(h,{onAction:C,disabled:a.value.size===0,class:"btn-select"},{default:i(()=>e[2]||(e[2]=[v(" 선택주문 ")])),_:1},8,["disabled"])])]),t("table",Q,[e[10]||(e[10]=t("colgroup",null,[t("col",{width:"5%"}),t("col",{width:"10%"}),t("col",{width:"50%"}),t("col",{width:"5%"}),t("col",{width:"10%"}),t("col",{width:"20%"})],-1)),t("thead",null,[o.value&&o.value.length>0?(u(),d("tr",W,e[4]||(e[4]=[t("th",null,null,-1),t("th",{colspan:"2"},"상품정보",-1),t("th",null,"수량",-1),t("th",null,"상품금액",-1),t("th",null,"배송정보",-1),t("th",null,"주문",-1)]))):k("",!0)]),t("tbody",null,[o.value&&o.value.length>0?(u(!0),d(x,{key:0},E(o.value,s=>(u(),d("tr",null,[t("td",X,[t("input",{type:"checkbox",checked:a.value.has(s.productId),onChange:P=>z(s.productId)},null,40,Y)]),t("td",null,[n(r,{to:`/products/${s.productId}`},{default:i(()=>[t("img",{class:"img-product",src:y(M)(s.thumbnail),alt:"상품 이미지"},null,8,Z)]),_:2},1032,["to"])]),t("td",null,[n(r,{to:`/products/${s.productId}`,class:"link-dark"},{default:i(()=>[v(f(s.name),1)]),_:2},1032,["to"]),t("div",ee,[t("small",te,f(s.originalPrice.toLocaleString()),1),t("span",null,f(y(A)(s.originalPrice,s.discountRatePercentage))+"원",1)])]),e[7]||(e[7]=t("td",null," 1 ",-1)),t("td",le,f(y(A)(s.originalPrice,s.discountRatePercentage))+"원 ",1),e[8]||(e[8]=t("td",null,"구매 후 바로 다운로드",-1)),t("td",ae,[n(h,{class:"w-100",onAction:P=>$(s.productId)},{default:i(()=>e[5]||(e[5]=[v("삭제")])),_:2},1032,["onAction"]),n(h,{class:"w-100",onAction:P=>O(s.productId)},{default:i(()=>e[6]||(e[6]=[v("주문하기 ")])),_:2},1032,["onAction"])])]))),256)):(u(),d("tr",oe,e[9]||(e[9]=[t("td",{colspan:"6",class:"td-empty text-muted"},[t("small",null,"장바구니가 비었습니다.")],-1)])))]),o.value&&o.value.length>0?(u(),d("tfoot",se,[t("tr",null,[t("td",re,"합계: "+f(w.value.toLocaleString())+"원",1)])])):k("",!0)])]),S.value?k("",!0):(u(),d(x,{key:0},[n(j,{"total-original-price":I.value,"total-discount-amount":D.value,"total-final-price":w.value},null,8,["total-original-price","total-discount-amount","total-final-price"]),t("section",ne,[n(h,{onAction:C,disabled:a.value.size===0},{default:i(()=>e[12]||(e[12]=[v("주문하기")])),_:1},8,["disabled"]),n(r,{to:"/"},{default:i(()=>[n(h,null,{default:i(()=>e[13]||(e[13]=[v("쇼핑 계속하기")])),_:1})]),_:1})])],64)),n(U)])}}},me=V(ce,[["__scopeId","data-v-05f8a2de"]]);export{me as default};
