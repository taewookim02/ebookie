import{_ as L,r as m,s as O,k as _,o as v,c as p,a as t,v as V,x as B,b as n,w as i,m as C,F,y as N,t as f,q as k,z as T,g,f as q,d}from"./index-B5gd4vQZ.js";import{D as E}from"./DeliveryAndRefundSection-CWRKdQGL.js";import{O as M}from"./OrderPricesSection-D3yLbrfX.js";import{A as h}from"./ActionButton-k27kh0OB.js";import{f as I}from"./format-D8BanFEv.js";import{g as U}from"./imgPath-CG_qeXUq.js";const j={class:"cart-container"},G={class:"cart"},H={class:"cart__control"},J={colspan:"2"},K={class:"table cart__table"},Q={key:0,class:"text-center"},W={class:"text-center"},X=["checked","onChange"],Y=["src"],Z={class:"text-muted prices"},ee={class:"text-cross mr-2"},te={class:"fw-bold"},le={class:"td-action"},oe={key:1},se={key:0},ae={colspan:"7",class:"text-end fw-bold"},re={class:"orders__action"},ne={__name:"CartPage",setup(ce){const s=m([]),c=O(),o=m(new Set),u=m(!1),b=T(),x=_(()=>s.value.filter(l=>o.value.has(l.productId)).reduce((l,e)=>l+e.originalPrice,0)),A=_(()=>s.value.filter(l=>o.value.has(l.productId)).reduce((l,e)=>{const r=e.originalPrice*e.discountRatePercentage/100;return l+r},0)),y=_(()=>s.value.filter(l=>o.value.has(l.productId)).reduce((l,e)=>{const r=e.originalPrice-e.originalPrice*e.discountRatePercentage/100;return l+r},0));(async()=>{try{const l=await g.get("/api/v1/cart");s.value=l.data}catch(l){console.log("fetchcartProducts() err:",l)}})();const D=async l=>{try{const e=await g.delete(`/api/v1/cart/${l}`);s.value=s.value.filter(r=>r.productId!==l),o.value.delete(l),c.info("장바구니 목록에서 삭제 완료!")}catch(e){console.log("handleDeleteClick() err:",e),c.error("삭제 중 에러 발생!")}},S=()=>{u.value?o.value=new Set(s.value.map(l=>l.productId)):o.value.clear()},$=l=>{o.value.has(l)?(o.value.delete(l),u.value=!1):(o.value.add(l),u.value=o.value.size===s.value.length)},R=async()=>{if(o.value.size===0){c.warning("삭제할 상품을 선택해주세요");return}try{const l=Array.from(o.value);await g.delete("/api/v1/cart/bulk",{data:{productIds:l}}),s.value=s.value.filter(e=>!o.value.has(e.productId)),o.value.clear(),u.value=!1,c.info(`${l.length}개 상품이 장바구니 목록에서 삭제되었습니다`)}catch(l){console.log("handleCheckedDelete() err:",l),c.error("선택한 상품 삭제 중 에러가 발생했습니다!")}},w=async()=>{try{const l=Array.from(o.value),r=(await g.post("/api/v1/orders",{productIds:l})).data.orderId;c.success("주문 생성 성공!"),b.push(`/orders/${r}`)}catch{c.error("주문 생성 실패!")}},z=async l=>{console.log("구매하기",l);try{const r=(await g.post("api/v1/orders",{productIds:[l]})).data.orderId;c.success("주문 생성 성공!"),b.push(`/orders/${r}`)}catch{c.error("주문 생성 실패!")}};return(l,e)=>{const r=q("RouterLink");return v(),p("div",j,[t("section",G,[e[11]||(e[11]=t("h1",{class:"mb-4"},"장바구니",-1)),t("div",H,[t("div",null,[V(t("input",{type:"checkbox",name:"all",id:"all","onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),onChange:S},null,544),[[B,u.value]])]),t("div",J,[e[3]||(e[3]=t("label",{for:"all"},"전체선택",-1)),n(h,{onAction:R,disabled:o.value.size===0,class:"btn-select"},{default:i(()=>e[1]||(e[1]=[d(" 선택삭제 ")])),_:1},8,["disabled"]),n(h,{onAction:w,disabled:o.value.size===0,class:"btn-select"},{default:i(()=>e[2]||(e[2]=[d(" 선택주문 ")])),_:1},8,["disabled"])])]),t("table",K,[e[10]||(e[10]=t("colgroup",null,[t("col",{width:"5%"}),t("col",{width:"10%"}),t("col",{width:"50%"}),t("col",{width:"5%"}),t("col",{width:"10%"}),t("col",{width:"20%"})],-1)),t("thead",null,[s.value&&s.value.length>0?(v(),p("tr",Q,e[4]||(e[4]=[t("th",null,null,-1),t("th",{colspan:"2"},"상품정보",-1),t("th",null,"수량",-1),t("th",null,"상품금액",-1),t("th",null,"배송정보",-1),t("th",null,"주문",-1)]))):C("",!0)]),t("tbody",null,[s.value&&s.value.length>0?(v(!0),p(F,{key:0},N(s.value,a=>(v(),p("tr",null,[t("td",W,[t("input",{type:"checkbox",checked:o.value.has(a.productId),onChange:P=>$(a.productId)},null,40,X)]),t("td",null,[n(r,{to:`/products/${a.productId}`},{default:i(()=>[t("img",{class:"img-product",src:k(U)(a.thumbnail),alt:"상품 이미지"},null,8,Y)]),_:2},1032,["to"])]),t("td",null,[n(r,{to:`/products/${a.productId}`,class:"link-dark"},{default:i(()=>[d(f(a.name),1)]),_:2},1032,["to"]),t("div",Z,[t("small",ee,f(a.originalPrice.toLocaleString()),1),t("span",null,f(k(I)(a.originalPrice,a.discountRatePercentage))+"원",1)])]),e[7]||(e[7]=t("td",null," 1 ",-1)),t("td",te,f(k(I)(a.originalPrice,a.discountRatePercentage))+"원 ",1),e[8]||(e[8]=t("td",null,"구매 후 바로 다운로드",-1)),t("td",le,[n(h,{class:"w-100",onAction:P=>D(a.productId)},{default:i(()=>e[5]||(e[5]=[d("삭제")])),_:2},1032,["onAction"]),n(h,{class:"w-100",onAction:P=>z(a.productId)},{default:i(()=>e[6]||(e[6]=[d("주문하기 ")])),_:2},1032,["onAction"])])]))),256)):(v(),p("tr",oe,e[9]||(e[9]=[t("td",{colspan:"6",class:"td-empty text-muted"},[t("small",null,"장바구니가 비었습니다.")],-1)])))]),s.value&&s.value.length>0?(v(),p("tfoot",se,[t("tr",null,[t("td",ae,"합계: "+f(y.value.toLocaleString())+"원",1)])])):C("",!0)])]),n(M,{"total-original-price":x.value,"total-discount-amount":A.value,"total-final-price":y.value},null,8,["total-original-price","total-discount-amount","total-final-price"]),t("section",re,[n(h,{onAction:w,disabled:o.value.size===0},{default:i(()=>e[12]||(e[12]=[d("주문하기")])),_:1},8,["disabled"]),n(r,{to:"/"},{default:i(()=>[n(h,null,{default:i(()=>e[13]||(e[13]=[d("쇼핑 계속하기")])),_:1})]),_:1})]),n(E)])}}},ge=L(ne,[["__scopeId","data-v-050347b4"]]);export{ge as default};
