import{_ as F,j as M,f as d,c as b,z as Q,L as j,o as n,a as i,b as h,e as t,p as K,G as T,F as Y,C as G,t as r,g,l as C,u as P,B as H,q as J,K as O,E as W,x as m,n as X,D as Z,k as x}from"./index-ibK3QWKb.js";import{C as ee,L as se,S as te}from"./CartButton-DV_QtIDy.js";import{b as ae}from"./format-B6-WTpBz.js";import{P as oe}from"./Pagination-CIUZq7gx.js";const ne={class:"product-list-page container py-5"},ie={key:0,class:"mb-4 text-center"},le={key:1,class:"mb-4 text-center"},re={key:2,class:"mb-4 text-center"},ce={class:"d-flex justify-content-end mb-4"},ue={key:3,class:"text-center py-5"},de={key:4,class:"text-center py-5"},ve={key:5,class:"product-list"},pe={class:"product-rank"},ge={class:"product-image"},he=["src"],me={class:"product-info"},fe={class:"product-name"},ye={class:"product-meta"},_e={class:"product-price-info"},Le={class:"original-price"},ke={class:"discounted-price"},Se={key:0,class:"discount-badge"},be={class:"product-sold"},Ce={class:"product-actions"},Ne={__name:"ProductRankingListPage",setup(Pe){const y=O(),c=W(),p=M(),v=d([]),_=d(0),R=d(0),L=d(0),k=d(!1),l=d(20),f=d(y.query),u=d(new URLSearchParams(f.value).toString()),w=b(()=>u.value.includes("sold")&&u.value.includes("desc")),B=b(()=>u.value.includes("publishedDate")&&u.value.includes("desc")),I=b(()=>u.value.includes("discountRate")&&u.value.includes("desc")),$=async s=>{try{await m.post(`/api/v1/saved/${s}`);const e=v.value.find(o=>o.id===s);e&&(e.isSaved=!e.isSaved,e.isSaved?p.success("찜 목록에 저장 완료!"):p.info("찜 목록에서 삭제 완료!"))}catch(e){console.log("handleSave() err:",e),e.status===401&&c.push("/login")}},z=async s=>{try{await m.post(`/api/v1/liked/${s}`);const e=v.value.find(o=>o.id===s);e&&(e.isLiked=!e.isLiked,e.isLiked?p.success("좋아요 목록에 저장 완료!"):p.info("좋아요 목록에서 삭제 완료!"))}catch(e){console.log("handleLike() err:",e),e.status===401&&c.push("/login")}},q=async s=>{try{await m.post(`/api/v1/cart/${s}`);const e=v.value.find(o=>o.id===s);e&&(e.isInCart=!e.isInCart,e.isInCart?p.success("장바구니 목록에 저장 완료!"):p.info("장바구니 목록에서 삭제 완료!"))}catch(e){console.log("handleCartAdd() err:",e),e.status===401&&c.push("/login")}},D=async s=>{try{console.log("handleBuy");const e=[s],a=(await m.post("/api/v1/orders",{productIds:e})).data.id;c.push(`/orders/${a}`)}catch(e){console.log("handleBuy() err:",e),e.status===401&&c.push("/login")}},A=s=>{const e=new URLSearchParams(f.value);return e.set("page",s),e.set("size",l.value),e.toString()},U=s=>{c.push(`/products?${A(s-1)}`)},V=()=>{const s=c.currentRoute.value.query;c.push({path:"/products",query:{page:"0",size:l.value,sort:s.sort||"publishedDate,desc"}})},N=async()=>{k.value=!0;try{const s=await m.get(`/api/v1/products?${u.value}&size=${l.value}`);v.value=s.data.products,_.value=s.data.totalPages,R.value=s.data.totalElements,L.value=s.data.currentPage}catch(s){console.error("Failed to fetch products:",s),v.value=[]}finally{k.value=!1}};return Q(()=>{const s=Number(y.query.size);s&&(l.value=s),N()}),j(y,(s,e)=>{f.value=s.query,u.value=new URLSearchParams(f.value).toString();const o=Number(s.query.size);o&&o!==l.value&&(l.value=o),N()},{deep:!0}),(s,e)=>{const o=X("RouterLink");return n(),i("div",ne,[w.value?(n(),i("h1",ie,"베스트셀러 순위")):h("",!0),B.value?(n(),i("h1",le,"신상품 순위")):h("",!0),I.value?(n(),i("h1",re,"세일 순위")):h("",!0),t("div",ce,[K(t("select",{class:"form-select form-select-sm",style:{width:"150px"},"onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a),onChange:V},e[1]||(e[1]=[t("option",{value:"10"},"10개씩 보기",-1),t("option",{value:"20"},"20개씩 보기",-1),t("option",{value:"50"},"50개씩 보기",-1)]),544),[[T,l.value]])]),k.value?(n(),i("div",ue,e[2]||(e[2]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):v.value.length?(n(),i("div",ve,[(n(!0),i(Y,null,G(v.value,(a,E)=>(n(),i("div",{class:"product-item",key:a.id},[t("div",pe,[t("span",null,r(L.value*l.value+E+1),1)]),t("div",ge,[g(o,{to:`/products/${a.id}`},{default:C(()=>[t("img",{src:P(Z)(a.thumbnail.fileName),alt:"상품 이미지"},null,8,he)]),_:2},1032,["to"])]),t("div",me,[t("h2",fe,[g(o,{to:`/products/${a.id}`,class:"link-dark"},{default:C(()=>[x(r(a.name),1)]),_:2},1032,["to"])]),t("div",ye,[t("span",null,r(a.authorNames)+" 저",1),e[4]||(e[4]=t("small",null,"|",-1)),t("span",null,r(a.publisherName),1),e[5]||(e[5]=t("small",null,"|",-1)),t("span",null,r(P(ae)(a.publishedDate)),1)]),t("div",_e,[t("small",Le,r(a.price.toLocaleString())+"원",1),t("span",ke,r((a.price-a.price*a.discountRate/100).toLocaleString())+"원",1),a.discountRate?(n(),i("span",Se,r(a.discountRate)+"%",1)):h("",!0)]),t("div",be,[t("span",null,"판매량 "+r(a.sold.toLocaleString())+"부",1)])]),t("div",Ce,[g(ee,{onCart:S=>q(a.id),"is-active":a.isInCart},null,8,["onCart","is-active"]),g(se,{onLike:S=>z(a.id),"is-active":a.isLiked},null,8,["onLike","is-active"]),g(te,{onSave:S=>$(a.id),"is-active":a.isSaved},null,8,["onSave","is-active"]),g(H,{onAction:S=>D(a.id),class:"buy-button"},{default:C(()=>e[6]||(e[6]=[x("구매하기")])),_:2},1032,["onAction"])])]))),128))])):(n(),i("div",de,e[3]||(e[3]=[t("div",{class:"empty-state"},[t("i",{class:"bi bi-book",style:{"font-size":"4rem",color:"var(--primary-color)"}}),t("h3",{class:"mt-4"},"상품이 없습니다"),t("p",{class:"text-muted"},"해당하는 상품을 찾을 수 없습니다.")],-1)]))),_.value>0?(n(),J(oe,{key:6,"current-page":L.value+1,"total-pages":_.value,onPageChange:U,class:"mt-4"},null,8,["current-page","total-pages"])):h("",!0)])}}},Ie=F(Ne,[["__scopeId","data-v-c7a57ede"]]);export{Ie as default};
