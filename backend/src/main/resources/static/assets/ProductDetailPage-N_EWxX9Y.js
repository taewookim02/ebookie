import{_ as I,o as u,c as m,a as e,F as E,n as N,t as g,s as $,C as B,p as c,J as K,E as F,K as p,d as x,k as A,b as o,w as R,j as G,P as J,G as q,r as C,l as V,L as U,M as Q,D as P,e as W,i as H,g as z,I as X,H as Z,x as ee,N as te}from"./index-DZyeJC7V.js";import{D as se}from"./DeliveryAndRefundSection-QjqVrcQF.js";import{A as L}from"./ActionButton-qA0NYUWD.js";import{L as oe,S as ae,C as ie}from"./CartButton-BVck5tvg.js";import{c as j}from"./format-B6-WTpBz.js";const le={class:"author-details"},ne={class:"author-details-container"},re={class:"author-container"},ce={class:"author-header"},de={class:"author-header__name"},ue={class:"author-body"},ve={__name:"AuthorDetailsSection",props:{detailDto:Object},setup(n){return(d,t)=>(u(),m("section",le,[t[0]||(t[0]=e("h3",null,"저자 소개",-1)),(u(!0),m(E,null,N(n.detailDto.authors,i=>(u(),m("div",ne,[e("div",re,[e("div",ce,[e("span",de,g(i.name)+" 저",1)]),e("div",ue,[e("p",null,g(i.description),1)])])]))),256))]))}},_e=I(ve,[["__scopeId","data-v-ad103c13"]]),pe={class:"details"},he={class:"details-container"},ge={class:"details-category"},me={class:"details-info"},we={__name:"BookDetailsSection",props:{detailDto:Object},setup(n){return(d,t)=>(u(),m("section",pe,[t[3]||(t[3]=e("h3",null,"작품소개",-1)),e("div",he,[e("div",ge,[t[0]||(t[0]=e("h4",{class:"details-category__heading"},"이 상품이 속한 분야",-1)),e("span",null,"eBook > IT > "+g(n.detailDto.categoryName),1)]),e("div",me,[t[1]||(t[1]=e("p",null," 파일은 결제내역 > 결제상세 > 다운로드 버튼을 눌러 다운로드 받으실 수 있습니다. (단, 로그인 및 결제 후 다운로드 이용 가능) ",-1)),t[2]||(t[2]=e("br",null,null,-1)),e("p",null,g(n.detailDto.description),1)])])]))}},fe=I(we,[["__scopeId","data-v-8c961b1b"]]),be={class:"hero"},De=["src"],$e={class:"hero__info"},ye={class:"info-header"},Se={class:"info-header__title"},ke={class:"info-header__audit text-muted"},xe={class:"info-header__review"},Ie={class:"info-header__review--icons"},ze={class:"info-header__review--avg"},Ce={class:"info-bottom pt-4"},Re={class:"info-bottom__price"},Le={class:"price text-muted price-original"},Ee={class:"price"},Be={key:0,class:"badge text-bg-danger"},Ne={class:"info-bottom__action"},Pe="http://localhost:8080",Ae={__name:"HeroSection",props:{detailDto:Object},emits:["scrollToReview","save","like","cart","buy"],setup(n,{emit:d}){const t=n,i=d,s=()=>{i("scrollToReview")},v=()=>i("save"),b=()=>i("like"),w=()=>i("cart"),D=()=>i("buy"),h=$(()=>t.detailDto&&t.detailDto.images&&t.detailDto.images.length>0?`${Pe}/api/v1/image?name=${t.detailDto.images[0].fileName}`:""),f=$(()=>{var r;const l=[];return(r=t.detailDto.authors)==null||r.forEach(S=>{l.push(S.name)}),l.join(", ")}),_=$(()=>{var l;if((l=t.detailDto)!=null&&l.publishedDate){const r=new Date(t.detailDto.publishedDate);return new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"long",day:"numeric"}).format(r)}return""}),y=$(()=>{var r,S;let l=0;return(r=t.detailDto.reviews)==null||r.forEach(O=>{l+=O.rating}),l?(l/((S=t.detailDto.reviews)==null?void 0:S.length)).toFixed(1):0}),k=$(()=>(t.detailDto.price-t.detailDto.price*t.detailDto.discountRate/100).toLocaleString()),a=$(()=>{const l=parseFloat(y.value),r=[];for(let S=1;S<=5;S++)r.push(S<=l);return r});return(l,r)=>{var S,O;return u(),m("section",be,[e("div",{class:F(["hero__image",{loading:!h.value}])},[h.value?(u(),m("img",{key:0,src:h.value,alt:"도서 썸네일"},null,8,De)):(u(),B(c(K),{key:1,size:"64",color:"#ccc",margin:"auto"}))],2),e("div",$e,[e("div",ye,[e("h1",Se,g(n.detailDto.name),1),e("div",ke,[e("span",null,g(f.value)+" 저",1),r[0]||(r[0]=e("span",{class:"spacer"},"|",-1)),e("span",null,g(n.detailDto.publisherName),1),r[1]||(r[1]=e("span",{class:"spacer"},"|",-1)),e("span",null,g(_.value),1)]),e("div",xe,[e("div",Ie,[(u(!0),m(E,null,N(a.value,(M,Y)=>(u(),B(c(p),{key:Y,size:16,color:M?"blue":"#ccc",weight:"fill",class:F({"empty-star":!M})},null,8,["color","class"]))),128))]),e("span",ze,g(y.value),1),r[2]||(r[2]=e("span",{class:"spacer text-muted"},"|",-1)),e("span",null,[e("a",{to:"#",class:"link-dark",onClick:s},"회원리뷰("+g((S=n.detailDto.reviews)==null?void 0:S.length)+"건)",1)])])]),e("div",Ce,[e("div",Re,[e("span",null,[r[3]||(r[3]=x("정가 ")),e("span",Le,g((O=n.detailDto.price)==null?void 0:O.toLocaleString())+"원",1)]),e("span",null,[r[4]||(r[4]=x("판매가 ")),e("strong",Ee,g(k.value)+"원",1),r[5]||(r[5]=x()),n.detailDto.discountRate?(u(),m("span",Be,g(n.detailDto.discountRate)+"%",1)):A("",!0)])]),e("div",Ne,[o(oe,{onLike:b,"is-active":n.detailDto.isLiked},null,8,["is-active"]),o(ae,{onSave:v,"is-active":n.detailDto.isSaved},null,8,["is-active"]),o(ie,{onCart:w,"is-active":n.detailDto.isInCart},null,8,["is-active"]),o(L,{onAction:D,"is-active":!0},{default:R(()=>r[6]||(r[6]=[x("구매하기")])),_:1})])])])])}}},Oe=I(Ae,[["__scopeId","data-v-39907c69"]]),Fe={class:"product-details"},je={class:"product-details__table table table-borderless"},Me={__name:"ProductDetailsSection",props:{detailDto:Object},setup(n){const d=n;return $(()=>j(d.detailDto.publishedDate)),G(()=>{}),(t,i)=>(u(),m("section",Fe,[i[5]||(i[5]=e("h3",null,"품목정보",-1)),e("table",je,[i[4]||(i[4]=e("colgroup",null,[e("col",{width:"20%"}),e("col",{width:"80%"})],-1)),e("tbody",null,[e("tr",null,[i[0]||(i[0]=e("th",null,"발행일",-1)),e("td",null,g(c(j)(d.detailDto.publishedDate)),1)]),i[1]||(i[1]=e("tr",null,[e("th",null,"이용안내"),e("td",null,[e("ul",null,[e("li",null,"배송 필요없음"),e("li",null,"결제 후 다운로드 가능"),e("li",null,"이용기간 제한없음")])])],-1)),i[2]||(i[2]=e("tr",null,[e("th",null,"파일포맷"),e("td",null,"PDF")],-1)),i[3]||(i[3]=e("tr",null,[e("th",null,"용량"),e("td",null,"11.83 MB")],-1))])])]))}},Te=I(Me,[["__scopeId","data-v-323f5df5"]]),Ve={class:"related"},Ue={__name:"RelatedProductsSection",props:{productId:String,detailDto:Object,categoryId:Number},setup(n){const d=n;return(t,i)=>(u(),m("section",Ve,[o(J,{products:d.detailDto.relatedProducts,sliderTitle:"관련 eBook 추천","category-id":d.categoryId},null,8,["products","category-id"])]))}},T=I(Ue,[["__scopeId","data-v-7a710162"]]),He={class:"review-body"},Ye={class:"review-header"},Ke={class:"review-header__writer"},Ge={key:0,class:"review-header__controls"},Je={class:"review-stars"},qe={class:"review-info"},Qe={class:"text-muted review-info__date"},We={key:0,class:"review-content"},Xe={key:1,class:"review-form__container"},Ze={class:"text-muted char-count"},et={__name:"ReviewBody",props:{review:Object,isEditing:Boolean},emits:["edit","editOpen","editCancel","delete"],setup(n,{emit:d}){const t=n,i=q(),s=d,v=C(t.review.content),b=()=>{s("edit",t.review.id,v.value)},w=()=>{s("delete",t.review.id)},D=()=>{s("editOpen",t.review.id)},h=()=>{console.log("handleEditCancel"),v.value=t.review.content,s("editCancel")},f=$(()=>i.getMemberEmail===t.review.writerEmail),_=$(()=>{const k=parseFloat(t.review.rating),a=[];for(let l=1;l<=5;l++)a.push(l<=k);return a}),y=$(()=>`${v.value.length} / 50`);return(k,a)=>(u(),m("div",He,[e("div",Ye,[e("strong",Ke,g(n.review.writerEmail),1),f.value?(u(),m("div",Ge,[o(L,{onAction:w},{default:R(()=>a[1]||(a[1]=[x("삭제")])),_:1}),o(L,{onAction:D},{default:R(()=>a[2]||(a[2]=[x("수정")])),_:1})])):A("",!0)]),e("div",Je,[(u(!0),m(E,null,N(_.value,l=>(u(),B(c(p),{size:16,color:l?"blue":"#ccc",weight:"fill"},null,8,["color"]))),256))]),e("div",qe,[e("small",Qe,g(c(j)(n.review.createdAt))+" 작성됨",1)]),n.isEditing?A("",!0):(u(),m("div",We,g(n.review.content),1)),n.isEditing?(u(),m("div",Xe,[V(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=l=>v.value=l),class:"review-content form-control w-100",rows:"3",maxlength:"50"},null,512),[[U,v.value]]),e("div",null,[o(L,{class:"btn-action",onClick:b},{default:R(()=>a[3]||(a[3]=[x("저장")])),_:1}),o(L,{class:"btn-action",onClick:h},{default:R(()=>a[4]||(a[4]=[x("취소")])),_:1})]),e("small",Ze,g(y.value),1)])):A("",!0)]))}},tt=I(et,[["__scopeId","data-v-e7cca043"]]),st={class:"review-container"},ot={class:"review-container__stars"},at={class:"stars-heading"},it={class:"stars-main"},lt={class:"stars-main__icons"},nt={class:"stars-main__numbers"},rt={class:"rating-avg"},ct={class:"review-container__percentage"},dt={class:"percetage-stars__row"},ut=["aria-valuenow"],vt={class:"percetage-stars__row"},_t=["aria-valuenow"],pt={class:"percetage-stars__row"},ht=["aria-valuenow"],gt={class:"percetage-stars__row"},mt=["aria-valuenow"],wt={class:"percetage-stars__row"},ft=["aria-valuenow"],bt={__name:"ReviewStats",props:{detailDto:Object},setup(n){const d=n;Q(()=>{});const t=$(()=>{var b;return(b=d.detailDto.reviews)!=null&&b.length?(d.detailDto.reviews.reduce((w,D)=>w+D.rating,0)/d.detailDto.reviews.length).toFixed(1):0}),i=$(()=>{const v=parseFloat(t.value),b=[];for(let w=1;w<=5;w++)b.push(w<=v);return b}),s=$(()=>{var w;if(!((w=d.detailDto.reviews)!=null&&w.length))return[0,0,0,0,0];const v=[0,0,0,0,0],b=d.detailDto.reviews.length;return d.detailDto.reviews.forEach(D=>{const h=Math.floor(D.rating)-1;v[h]++}),v.map(D=>(D/b*100).toFixed(0))});return(v,b)=>{var w;return u(),m("div",st,[e("div",ot,[e("span",at,g((w=n.detailDto.reviews)==null?void 0:w.length)+"명의 eBookie회원이 평가한 평균별점",1),e("div",it,[e("div",lt,[(u(!0),m(E,null,N(i.value,(D,h)=>(u(),B(c(p),{key:h,size:32,color:D?"blue":"#ccc",weight:"fill",class:F({"empty-star":!D})},null,8,["color","class"]))),128))]),e("div",nt,[e("span",rt,g(t.value),1),b[0]||(b[0]=e("span",{class:"rating-total text-muted"}," / 5.0",-1))])])]),e("div",ct,[e("div",dt,[o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"})]),e("div",{class:"progress",role:"progressbar","aria-valuenow":s.value[4],"aria-valuemin":"0","aria-valuemax":"100"},[e("div",{class:"progress-bar",style:P(`width: ${s.value[4]}%`)},g(s.value[4])+"%",5)],8,ut),e("div",vt,[o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,color:"blue"})]),e("div",{class:"progress",role:"progressbar","aria-valuenow":s.value[3],"aria-valuemin":"0","aria-valuemax":"100"},[e("div",{class:"progress-bar",style:P(`width: ${s.value[3]}%`)},g(s.value[3])+"%",5)],8,_t),e("div",pt,[o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,color:"blue"}),o(c(p),{size:16,color:"blue"})]),e("div",{class:"progress",role:"progressbar","aria-valuenow":s.value[2],"aria-valuemin":"0","aria-valuemax":"100"},[e("div",{class:"progress-bar",style:P(`width: ${s.value[2]}%`)},g(s.value[2])+"%",5)],8,ht),e("div",gt,[o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,color:"blue"}),o(c(p),{size:16,color:"blue"}),o(c(p),{size:16,color:"blue"})]),e("div",{class:"progress",role:"progressbar","aria-valuenow":s.value[1],"aria-valuemin":"0","aria-valuemax":"100"},[e("div",{class:"progress-bar",style:P(`width: ${s.value[1]}%`)},g(s.value[1])+"%",5)],8,mt),e("div",wt,[o(c(p),{size:16,weight:"fill",color:"blue"}),o(c(p),{size:16,color:"blue"}),o(c(p),{size:16,color:"blue"}),o(c(p),{size:16,color:"blue"}),o(c(p),{size:16,color:"blue"})]),e("div",{class:"progress",role:"progressbar","aria-valuenow":s.value[0],"aria-valuemin":"0","aria-valuemax":"100"},[e("div",{class:"progress-bar",style:P(`width: ${s.value[0]}%`)},g(s.value[0])+"%",5)],8,ft)])])}}},Dt=I(bt,[["__scopeId","data-v-4e8bd0ca"]]),$t={class:"review-form__rating"},yt={class:"review-form__container"},St={class:"text-muted char-count"},kt={__name:"ReviewForm",props:{detailDto:Object},emits:["save"],setup(n,{emit:d}){const t=C(""),i=C(0),s=d,v=$({get:()=>t.value,set:f=>{t.value=f.substring(0,50)}}),b=$(()=>`${t.value.length} / 50`),w=$(()=>{const f=[];for(let _=1;_<=5;_++)f.push(_<=i.value);return f}),D=()=>{s("save",{content:v.value,rating:i.value})},h=f=>{i.value=f};return(f,_)=>(u(),m("form",{class:"review-form",onSubmit:W(D,["prevent"])},[_[2]||(_[2]=e("h3",null,"리뷰 작성",-1)),e("div",$t,[(u(!0),m(E,null,N(w.value,(y,k)=>(u(),B(c(p),{key:k,size:24,color:y?"blue":"#ccc",weight:"fill",class:"star-icon",onClick:a=>h(k+1)},null,8,["color","onClick"]))),128))]),e("div",yt,[V(e("textarea",{"onUpdate:modelValue":_[0]||(_[0]=y=>v.value=y),name:"content",id:"review-content",class:"review-content form-control w-100",rows:"3",maxlength:"50"},null,512),[[U,v.value]]),o(L,{class:"btn-action",type:"submit"},{default:R(()=>_[1]||(_[1]=[x("등록")])),_:1}),e("small",St,g(b.value),1)])],32))}},xt=I(kt,[["__scopeId","data-v-9421637d"]]),It={class:"review"},zt={__name:"ReviewSection",props:{detailDto:Object},setup(n){const d=H(),t=n,i=C(null),s=async h=>{if(h.rating===0){d.error("별점을 선택해주세요.");return}const _=(await z.post("/api/v1/reviews",{content:h.content,rating:h.rating,productId:t.detailDto.id})).data;t.detailDto.reviews.push(_)},v=async(h,f)=>{try{const _=await z.patch(`/api/v1/reviews/${h}`,{content:f});_.status<300&&(t.detailDto.reviews=t.detailDto.reviews.map(y=>y.id===h?_.data:y),d.success("리뷰가 수정되었습니다."),i.value=null)}catch(_){console.log(_)}},b=async h=>{try{(await z.delete(`/api/v1/reviews/${h}`)).status<300&&(t.detailDto.reviews=t.detailDto.reviews.filter(_=>_.id!==h),d.success("리뷰가 삭제되었습니다."),i.value=null)}catch(f){console.log(f)}},w=h=>{i.value=h},D=()=>{i.value=null};return(h,f)=>(u(),m("section",It,[f[0]||(f[0]=e("div",{class:"review-header"},[e("h3",null,"회원리뷰")],-1)),o(Dt,{"detail-dto":n.detailDto},null,8,["detail-dto"]),o(xt,{"detail-dto":n.detailDto,onSave:s},null,8,["detail-dto"]),(u(!0),m(E,null,N(n.detailDto.reviews,_=>(u(),B(tt,{review:_,onEdit:v,onEditOpen:w,onEditCancel:D,onDelete:b,"is-editing":i.value===_.id},null,8,["review","is-editing"]))),256))]))}},Ct=I(zt,[["__scopeId","data-v-133324a1"]]),Rt={key:0,class:"loading"},Lt={key:1,class:"empty-state"},Et={__name:"ProductDetailPage",setup(n){const d=Z(),t=ee(),i=C(null),s=C({}),v=H(),b=C(!0),w=C(!1),D=()=>{i.value.$el.scrollIntoView({behavior:"smooth"})},h=async a=>{var l;try{b.value=!0,w.value=!1;const r=await z.get(`/api/v1/products/${a}`);s.value=r.data}catch(r){console.log("err:",r),w.value=!0,((l=r.response)==null?void 0:l.status)===404?(v.error("존재하지 않는 상품입니다."),t.push("/products")):v.error("상품 정보를 불러올 수 없습니다.")}finally{b.value=!1}};X(()=>d.params.id,a=>{a&&h(a)},{immediate:!0});const f=async()=>{try{const a=d.params.id;await z.post(`/api/v1/saved/${a}`),s.value.isSaved=!s.value.isSaved,s.value.isSaved?v.success("찜 목록에 저장 완료!"):v.info("찜 목록에서 삭제 완료!")}catch(a){console.log("handleSave() err:",a),a.status===401&&t.push("/login")}},_=async()=>{try{const a=d.params.id;await z.post(`/api/v1/liked/${a}`),s.value.isLiked=!s.value.isLiked,s.value.isLiked?v.success("좋아요 목록에 저장 완료!"):v.info("좋아요 목록에서 삭제 완료!")}catch(a){console.log("handleLike() err:",a),a.status===401&&t.push("/login")}},y=async()=>{try{const a=d.params.id;await z.post(`/api/v1/cart/${a}`),s.value.isInCart=!s.value.isInCart,s.value.isInCart?v.success("장바구니 목록에 저장 완료!"):v.info("장바구니 목록에서 삭제 완료!")}catch(a){console.log("handleLike() err:",a),a.status===401&&t.push("/login")}},k=async()=>{try{console.log("handleBuy");const a=[d.params.id],r=(await z.post("/api/v1/orders",{productIds:a})).data.id;t.push(`/orders/${r}`)}catch(a){console.log("handleBuy() err:",a),a.status===401&&t.push("/login")}};return(a,l)=>b.value?(u(),m("div",Rt,[o(te)])):w.value?(u(),m("div",Lt,[l[2]||(l[2]=e("i",{class:"bi bi-exclamation-circle",style:{"font-size":"4rem"}},null,-1)),l[3]||(l[3]=e("h3",{class:"mt-4"},"상품 정보를 불러올 수 없습니다",-1)),l[4]||(l[4]=e("p",{class:"text-muted"},"잠시 후 다시 시도해주세요.",-1)),o(L,{class:"mt-3",onAction:l[0]||(l[0]=r=>c(t).push("/products"))},{default:R(()=>l[1]||(l[1]=[x("상품 목록으로")])),_:1})])):s.value?(u(),m(E,{key:2},[o(Oe,{"detail-dto":s.value,onScrollToReview:D,onSave:f,onLike:_,onCart:y,onBuy:k},null,8,["detail-dto"]),o(T,{"detail-dto":s.value,"category-id":s.value.categoryId},null,8,["detail-dto","category-id"]),o(Te,{"detail-dto":s.value},null,8,["detail-dto"]),o(fe,{"detail-dto":s.value},null,8,["detail-dto"]),o(_e,{"detail-dto":s.value},null,8,["detail-dto"]),o(Ct,{ref_key:"reviewSection",ref:i,"detail-dto":s.value},null,8,["detail-dto"]),o(T,{"detail-dto":s.value,"category-id":s.value.categoryId},null,8,["detail-dto","category-id"]),o(se)],64)):A("",!0)}},Ft=I(Et,[["__scopeId","data-v-2386f5fb"]]);export{Ft as default};
