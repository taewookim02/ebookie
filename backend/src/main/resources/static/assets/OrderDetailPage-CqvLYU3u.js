import{O as j}from"./OrderPricesSection-04zw1TOy.js";import{A as h}from"./ActionButton-Ddcx3E1O.js";import{a as b,f as w}from"./format-B6-WTpBz.js";import{_ as B,o as a,c as i,a as e,F as N,n as k,E as T,t as A,i as J,G as H,r as m,s as O,j as W,b as g,w as V,p,q,H as Z,x as X,g as C,d as M}from"./index-BC9KMlXn.js";/* empty css                                                                     */var G;let L=null;const Y={jsSdkUrl:(G=void 0)!==null&&G!==void 0?G:"https://cdn.portone.io/v2/browser-sdk.js"};function $(){return document.querySelector(`script[src="${Y.jsSdkUrl}"]`)}function ee(){const o=document.createElement("script");o.src=Y.jsSdkUrl;const n=document.head||document.body;if(!n)throw new Error("[PortOne] Expected document.body not to be null");return n.appendChild(o)}function I(){return L??(L=new Promise((o,n)=>{if(window.PortOne)return o(window.PortOne);try{const r=$()||ee();r.addEventListener("load",()=>{if(window.PortOne)return o(window.PortOne);n(new Error("[PortOne] Failed to load window.PortOne"))}),r.addEventListener("error",()=>{n(new Error("[PortOne] Failed to load window.PortOne"))})}catch(r){return n(r)}}))}function te(o){return I().then(n=>n.requestIdentityVerification(o))}function ne(o){return I().then(n=>n.requestIssueBillingKeyAndPay(o))}function se(o){return I().then(n=>n.requestIssueBillingKey(o))}function oe(o){return I().then(n=>n.requestPayment(o))}function re(o,n){return I().then(r=>r.loadPaymentUI(o,n))}function ae(o,n){return I().then(r=>r.loadIssueBillingKeyUI(o,n))}function ie(o){return I().then(n=>n.updateLoadPaymentUIRequest(o))}function le(o){return I().then(n=>n.updateLoadIssueBillingKeyUIRequest(o))}const de={HTML5_INICIS:"PG_PROVIDER_HTML5_INICIS",PAYPAL:"PG_PROVIDER_PAYPAL",INICIS:"PG_PROVIDER_INICIS",DANAL:"PG_PROVIDER_DANAL",NICE:"PG_PROVIDER_NICE",DANAL_TPAY:"PG_PROVIDER_DANAL_TPAY",UPLUS:"PG_PROVIDER_UPLUS",NAVERPAY:"PG_PROVIDER_NAVERPAY",SETTLE:"PG_PROVIDER_SETTLE",KCP:"PG_PROVIDER_KCP",MOBILIANS:"PG_PROVIDER_MOBILIANS",KAKAOPAY:"PG_PROVIDER_KAKAOPAY",NAVERCO:"PG_PROVIDER_NAVERCO",KICC:"PG_PROVIDER_KICC",EXIMBAY:"PG_PROVIDER_EXIMBAY",SMILEPAY:"PG_PROVIDER_SMILEPAY",PAYCO:"PG_PROVIDER_PAYCO",KCP_BILLING:"PG_PROVIDER_KCP_BILLING",ALIPAY:"PG_PROVIDER_ALIPAY",CHAI:"PG_PROVIDER_CHAI",BLUEWALNUT:"PG_PROVIDER_BLUEWALNUT",SMARTRO:"PG_PROVIDER_SMARTRO",PAYMENTWALL:"PG_PROVIDER_PAYMENTWALL",TOSSPAYMENTS:"PG_PROVIDER_TOSSPAYMENTS",KCP_QUICK:"PG_PROVIDER_KCP_QUICK",DAOU:"PG_PROVIDER_DAOU",GALAXIA:"PG_PROVIDER_GALAXIA",TOSSPAY:"PG_PROVIDER_TOSSPAY",KCP_DIRECT:"PG_PROVIDER_KCP_DIRECT",SETTLE_ACC:"PG_PROVIDER_SETTLE_ACC",SETTLE_FIRM:"PG_PROVIDER_SETTLE_FIRM",INICIS_UNIFIED:"PG_PROVIDER_INICIS_UNIFIED",KSNET:"PG_PROVIDER_KSNET",PAYPAL_V2:"PG_PROVIDER_PAYPAL_V2",SMARTRO_V2:"PG_PROVIDER_SMARTRO_V2",NICE_V2:"PG_PROVIDER_NICE_V2",TOSS_BRANDPAY:"PG_PROVIDER_TOSS_BRANDPAY",WELCOME:"PG_PROVIDER_WELCOME",TOSSPAY_V2:"PG_PROVIDER_TOSSPAY_V2",INICIS_V2:"PG_PROVIDER_INICIS_V2",KPN:"PG_PROVIDER_KPN",KCP_V2:"PG_PROVIDER_KCP_V2",HYPHEN:"PG_PROVIDER_HYPHEN",EXIMBAY_V2:"PG_PROVIDER_EXIMBAY_V2"};Object.entries(de).reduce((o,[n,r])=>Object.assign(Object.assign({},o),{[r]:n}),{});const ce={requestIdentityVerification:te,requestIssueBillingKeyAndPay:ne,requestIssueBillingKey:se,requestPayment:oe,loadPaymentUI:re,loadIssueBillingKeyUI:ae,updateLoadPaymentUIRequest:ie,updateLoadIssueBillingKeyUIRequest:le},ue="data:image/gif;base64,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",Pe={class:"order__payment"},Ae={class:"payment__method"},Ie={class:"payment__method--list"},_e=["onClick"],Ee=["src","alt"],Re={key:1},me={class:"payment__info"},pe={class:"payment__info--price"},De={__name:"OrderPaymentSection",props:{totalFinalPrice:Number,pgMethod:String},emits:["update:pgMethod"],setup(o,{emit:n}){const r=[{id:"kakao",name:"Kakao",icon:ue}],l=n,y=E=>{l("update:pgMethod",E)};return(E,u)=>(a(),i("section",Pe,[u[1]||(u[1]=e("h3",null,"결제방법",-1)),e("div",Ae,[e("div",Ie,[(a(),i(N,null,k(r,P=>e("div",{class:T(["payment__method--list-item",{selected:o.pgMethod===P.id}]),key:P.id,onClick:R=>y(P.id)},[P.icon?(a(),i("img",{key:0,src:P.icon,alt:P.name},null,8,Ee)):(a(),i("span",Re,A(P.name),1))],10,_e)),64))])]),e("div",me,[u[0]||(u[0]=e("div",{class:"payment__info--text"},"최종 결제금액",-1)),e("div",pe,A(o.totalFinalPrice.toLocaleString())+"원",1)])]))}},Oe=B(De,[["__scopeId","data-v-c23f9538"]]),ge={key:0,class:"loading"},ye={key:1,class:"empty-state"},Se={key:2,class:"empty-state"},ve={key:3,class:"order"},fe={class:"order__info"},Ce={class:"table-responsive"},Ge={class:"table order__info--table"},Le=["src"],Ne={class:"product-info"},he={class:"product-name"},be={class:"d-md-none mobile-details"},we={class:"text-center align-middle d-none d-md-table-cell"},Ve={class:"text-center align-middle d-none d-md-table-cell"},Me={class:"text-center align-middle d-none d-md-table-cell"},Be={class:"text-center align-middle d-none d-md-table-cell"},ke={class:"payment__action"},Te={key:1,class:"order__status"},Ye={key:0},Ue={key:1},xe={key:2},Fe={key:3},Ke={__name:"OrderDetailPage",setup(o){const n=Z(),r=X(),l=J(),y=H(),E=n.params.id,u=m([]),P=m("kakao"),R=m({status:"PENDING"}),_=m("PENDING"),S=m(!0),v=m(!1),U=async d=>{var t,s;try{S.value=!0,v.value=!1;const c=await C.get(`/api/v1/orders/${d}`);if(!c.data)throw new Error("주문을 찾을 수 없습니다.");if(!c.data.orderStatus)throw new Error("Server response missing orderStatus");u.value=c.data.orderDetailDtos,_.value=c.data.orderStatus}catch(c){console.error("Order detail fetch error:",c),v.value=!0,((t=c.response)==null?void 0:t.status)===403?(l.error("접근 권한이 없는 주문입니다."),r.push("/orders")):((s=c.response)==null?void 0:s.status)===404?(l.error("존재하지 않는 주문입니다."),r.push("/orders")):l.error("주문 정보 로드에 실패했습니다!")}finally{S.value=!1}},x=O(()=>u.value.reduce((d,t)=>d+t.originalPrice,0)),F=O(()=>u.value.reduce((d,t)=>{const s=t.originalPrice*t.discountRatePercentage/100;return d+s},0)),D=O(()=>u.value.reduce((d,t)=>{const s=t.originalPrice-t.originalPrice*t.discountRatePercentage/100;return d+s},0)),K=O(()=>{switch(P.value){case"kakao":return"channel-key-bdb9666b-9eba-4cc3-bc3e-cca13a1ff2f9";default:return"channel-key-bdb9666b-9eba-4cc3-bc3e-cca13a1ff2f9"}}),z=()=>[...crypto.getRandomValues(new Uint32Array(2))].map(d=>d.toString(16).padStart(8,"0")).join(""),Q=async()=>{var d;if(!(!confirm("구매 하시겠습니까?")||D.value<=0))try{const t=z();if(!E){l.error("주문 정보가 올바르지 않습니다.");return}const s=await C.post("/api/v1/payments",{paymentId:t,orderId:E,paidPrice:D.value,paymentStatus:"PENDING"});if(!s.data){l.error("결제 생성에 실패했습니다. 다시 시도해주세요.");return}R.value={status:"PENDING"};const c=await ce.requestPayment({storeId:"store-40493184-ea60-455e-93b1-94dc0b39f87f",channelKey:K.value,paymentId:s.data.paymentId,orderName:"ebookie 상품구매",totalAmount:D.value,currency:"KRW",payMethod:"EASY_PAY",productType:"PRODUCT_TYPE_DIGITAL",isCulturalExpense:!0,customer:{email:y.getMemberEmail},customData:{item:s.data.paymentId}});if(c.code!==void 0||!c.paymentId){R.value={status:"FAILED"},l.error(`결제에 실패했습니다: ${c.message||"알 수 없는 오류"}`);return}const f=await C.post("/api/v1/payments/complete",{paymentId:c.paymentId});if(!f.data.orderStatus)throw new Error("Server response missing orderStatus");switch(R.value.status=f.data.paymentStatus,_.value=f.data.orderStatus,R.value.status){case"PAID":l.success("결제가 완료되었습니다!"),r.push("/library");break;case"FAILED":l.error("결제 처리 중 오류가 발생했습니다.");break;case"CANCELLED":l.info("결제가 취소되었습니다.");break;default:l.warning("알 수 없는 결제 상태입니다.")}}catch(t){console.error("Payment creation error:",t),R.value={status:"FAILED"},((d=t.response)==null?void 0:d.status)===409?l.error("이미 처리 중인 결제가 있습니다. 잠시 후 다시 시도해주세요."):l.error("결제 처리 중 오류가 발생했습니다. 다시 시도해주세요.");return}};return W(()=>{U(E)}),(d,t)=>S.value?(a(),i("div",ge,t[2]||(t[2]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):v.value?(a(),i("div",ye,t[3]||(t[3]=[e("i",{class:"bi bi-exclamation-circle",style:{"font-size":"4rem"}},null,-1),e("h3",{class:"mt-4"},"주문 정보를 불러올 수 없습니다",-1),e("p",{class:"text-muted"},"잠시 후 다시 시도해주세요.",-1)]))):u.value.length?(a(),i("div",ve,[e("section",fe,[t[12]||(t[12]=e("h3",null,"주문/결제",-1)),e("div",Ce,[e("table",Ge,[t[10]||(t[10]=e("colgroup",{class:"d-none d-md-table-column-group"},[e("col",{width:"10%"}),e("col",{width:"45%"}),e("col",{width:"10%"}),e("col",{width:"5%"}),e("col",{width:"10%"}),e("col",{width:"10%"}),e("col",{width:"10%"})],-1)),t[11]||(t[11]=e("thead",{class:"text-center"},[e("tr",null,[e("th",{colspan:"2"},"상품명"),e("th",{class:"d-none d-md-table-cell"},"정가"),e("th",{class:"d-none d-md-table-cell"},"수량"),e("th",{class:"d-none d-md-table-cell"},"할인금액"),e("th",{class:"d-none d-md-table-cell"},"합계"),e("th",{class:"d-none d-md-table-cell"},"배송일")])],-1)),e("tbody",null,[(a(!0),i(N,null,k(u.value,s=>(a(),i("tr",null,[e("td",null,[e("img",{src:p(q)(s.thumbnail),alt:"상품 이미지",class:"product-image"},null,8,Le)]),e("td",null,[e("div",Ne,[e("span",he,A(s.name),1),e("div",be,[e("div",null,"정가: "+A(s.originalPrice.toLocaleString())+"원",1),e("div",null,"수량: "+A(s.quantity),1),e("div",null,"할인: "+A(p(b)(s.originalPrice,s.discountRatePercentage))+"원",1),e("div",null,"합계: "+A(p(w)(s.originalPrice,s.discountRatePercentage))+"원",1),t[8]||(t[8]=e("div",null,"배송: 무배송 (결제 후 다운로드)",-1))])])]),e("td",we,A(s.originalPrice.toLocaleString())+"원 ",1),e("td",Ve,A(s.quantity),1),e("td",Me,A(p(b)(s.originalPrice,s.discountRatePercentage))+"원 ",1),e("td",Be,A(p(w)(s.originalPrice,s.discountRatePercentage))+"원 ",1),t[9]||(t[9]=e("td",{class:"text-center align-middle d-none d-md-table-cell"}," 무배송 (결제 후 다운로드) ",-1))]))),256))])])])]),g(j,{"total-original-price":x.value,"total-discount-amount":F.value,"total-final-price":D.value},null,8,["total-original-price","total-discount-amount","total-final-price"]),_.value==="PENDING"?(a(),i(N,{key:0},[g(Oe,{"total-final-price":D.value,"pg-method":P.value,"onUpdate:pgMethod":t[1]||(t[1]=s=>P.value=s)},null,8,["total-final-price","pg-method"]),e("div",ke,[g(h,{class:"w-100 payment__action--button",onAction:Q},{default:V(()=>t[13]||(t[13]=[M("결제하기")])),_:1})])],64)):(a(),i("section",Te,[t[14]||(t[14]=e("h3",null,"주문 상태",-1)),e("div",{class:T(["status-message",_.value.toLowerCase()])},[_.value==="PAID"?(a(),i("p",Ye,"결제가 완료된 주문입니다.")):_.value==="CANCELLED"?(a(),i("p",Ue,"취소된 주문입니다.")):_.value==="REFUNDED"?(a(),i("p",xe,"환불된 주문입니다.")):(a(),i("p",Fe,"알 수 없는 주문 상태입니다."))],2)]))])):(a(),i("div",Se,[t[5]||(t[5]=e("i",{class:"bi bi-cart",style:{"font-size":"4rem"}},null,-1)),t[6]||(t[6]=e("h3",{class:"mt-4"},"주문 내역이 없습니다",-1)),t[7]||(t[7]=e("p",{class:"text-muted"},"주문하신 상품이 없습니다.",-1)),g(h,{class:"mt-3",onAction:t[0]||(t[0]=s=>p(r).push("/products"))},{default:V(()=>t[4]||(t[4]=[M("상품 보러가기")])),_:1})]))}},We=B(Ke,[["__scopeId","data-v-e356fbe3"]]);export{We as default};
