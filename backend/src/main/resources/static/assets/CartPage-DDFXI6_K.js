import{_ as V,r as _,s as B,k as m,o as d,c as u,a as t,v as F,x as N,b as n,w as i,m as k,F as I,y as E,t as f,q as y,z as T,g,f as q,d as v}from"./index-BQLI52zX.js";import{D as M}from"./DeliveryAndRefundSection-CGa-eY-y.js";import{O as U}from"./OrderPricesSection-B8jNt_nk.js";import{A as h}from"./ActionButton-Djd-R_q9.js";import{f as x}from"./format-D8BanFEv.js";import{g as j}from"./imgPath-CG_qeXUq.js";const G={class:"cart-container"},H={class:"cart"},J={class:"cart__control"},K={colspan:"2"},Q={class:"table cart__table"},W={key:0,class:"text-center"},X={class:"text-center"},Y=["checked","onChange"],Z=["src"],ee={class:"text-muted prices"},te={class:"text-cross mr-2"},le={class:"fw-bold"},oe={class:"td-action"},se={key:1},ae={key:0},re={colspan:"7",class:"text-end fw-bold"},ne={class:"orders__action"},ce={__name:"CartPage",setup(ie){const s=_([]),c=B(),o=_(new Set),p=_(!1),b=T(),A=m(()=>s.value.filter(l=>o.value.has(l.productId)).reduce((l,e)=>l+e.originalPrice,0)),D=m(()=>s.value.filter(l=>o.value.has(l.productId)).reduce((l,e)=>{const r=e.originalPrice*e.discountRatePercentage/100;return l+r},0)),w=m(()=>s.value.filter(l=>o.value.has(l.productId)).reduce((l,e)=>{const r=e.originalPrice-e.originalPrice*e.discountRatePercentage/100;return l+r},0)),S=m(()=>s.value.length===0);(async()=>{try{const l=await g.get("/api/v1/cart");s.value=l.data}catch(l){console.log("fetchCartProducts() err:",l)}})();const $=async l=>{try{const e=await g.delete(`/api/v1/cart/${l}`);s.value=s.value.filter(r=>r.productId!==l),o.value.delete(l),c.info("장바구니 목록에서 삭제 완료!")}catch(e){console.log("handleDeleteClick() err:",e),c.error("삭제 중 에러 발생!")}},R=()=>{p.value?o.value=new Set(s.value.map(l=>l.productId)):o.value.clear()},z=l=>{o.value.has(l)?(o.value.delete(l),p.value=!1):(o.value.add(l),p.value=o.value.size===s.value.length)},L=async()=>{if(o.value.size===0){c.warning("삭제할 상품을 선택해주세요");return}try{const l=Array.from(o.value);await g.delete("/api/v1/cart/bulk",{data:{productIds:l}}),s.value=s.value.filter(e=>!o.value.has(e.productId)),o.value.clear(),p.value=!1,c.info(`${l.length}개 상품이 장바구니 목록에서 삭제되었습니다`)}catch(l){console.log("handleCheckedDelete() err:",l),c.error("선택한 상품 삭제 중 에러가 발생했습니다!")}},C=async()=>{try{const l=Array.from(o.value),r=(await g.post("/api/v1/orders",{productIds:l})).data.orderId;c.success("주문 생성 성공!"),b.push(`/orders/${r}`)}catch{c.error("주문 생성 실패!")}},O=async l=>{console.log("구매하기",l);try{const r=(await g.post("/api/v1/orders",{productIds:[l]})).data.orderId;c.success("주문 생성 성공!"),b.push(`/orders/${r}`)}catch{c.error("주문 생성 실패!")}};return(l,e)=>{const r=q("RouterLink");return d(),u("div",G,[t("section",H,[e[11]||(e[11]=t("h1",{class:"mb-4"},"장바구니",-1)),t("div",J,[t("div",null,[F(t("input",{type:"checkbox",name:"all",id:"all","onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),onChange:R},null,544),[[N,p.value]])]),t("div",K,[e[3]||(e[3]=t("label",{for:"all"},"전체선택",-1)),n(h,{onAction:L,disabled:o.value.size===0,class:"btn-select"},{default:i(()=>e[1]||(e[1]=[v(" 선택삭제 ")])),_:1},8,["disabled"]),n(h,{onAction:C,disabled:o.value.size===0,class:"btn-select"},{default:i(()=>e[2]||(e[2]=[v(" 선택주문 ")])),_:1},8,["disabled"])])]),t("table",Q,[e[10]||(e[10]=t("colgroup",null,[t("col",{width:"5%"}),t("col",{width:"10%"}),t("col",{width:"50%"}),t("col",{width:"5%"}),t("col",{width:"10%"}),t("col",{width:"20%"})],-1)),t("thead",null,[s.value&&s.value.length>0?(d(),u("tr",W,e[4]||(e[4]=[t("th",null,null,-1),t("th",{colspan:"2"},"상품정보",-1),t("th",null,"수량",-1),t("th",null,"상품금액",-1),t("th",null,"배송정보",-1),t("th",null,"주문",-1)]))):k("",!0)]),t("tbody",null,[s.value&&s.value.length>0?(d(!0),u(I,{key:0},E(s.value,a=>(d(),u("tr",null,[t("td",X,[t("input",{type:"checkbox",checked:o.value.has(a.productId),onChange:P=>z(a.productId)},null,40,Y)]),t("td",null,[n(r,{to:`/products/${a.productId}`},{default:i(()=>[t("img",{class:"img-product",src:y(j)(a.thumbnail),alt:"상품 이미지"},null,8,Z)]),_:2},1032,["to"])]),t("td",null,[n(r,{to:`/products/${a.productId}`,class:"link-dark"},{default:i(()=>[v(f(a.name),1)]),_:2},1032,["to"]),t("div",ee,[t("small",te,f(a.originalPrice.toLocaleString()),1),t("span",null,f(y(x)(a.originalPrice,a.discountRatePercentage))+"원",1)])]),e[7]||(e[7]=t("td",null," 1 ",-1)),t("td",le,f(y(x)(a.originalPrice,a.discountRatePercentage))+"원 ",1),e[8]||(e[8]=t("td",null,"구매 후 바로 다운로드",-1)),t("td",oe,[n(h,{class:"w-100",onAction:P=>$(a.productId)},{default:i(()=>e[5]||(e[5]=[v("삭제")])),_:2},1032,["onAction"]),n(h,{class:"w-100",onAction:P=>O(a.productId)},{default:i(()=>e[6]||(e[6]=[v("주문하기 ")])),_:2},1032,["onAction"])])]))),256)):(d(),u("tr",se,e[9]||(e[9]=[t("td",{colspan:"6",class:"td-empty text-muted"},[t("small",null,"장바구니가 비었습니다.")],-1)])))]),s.value&&s.value.length>0?(d(),u("tfoot",ae,[t("tr",null,[t("td",re,"합계: "+f(w.value.toLocaleString())+"원",1)])])):k("",!0)])]),S.value?k("",!0):(d(),u(I,{key:0},[n(U,{"total-original-price":A.value,"total-discount-amount":D.value,"total-final-price":w.value},null,8,["total-original-price","total-discount-amount","total-final-price"]),t("section",ne,[n(h,{onAction:C,disabled:o.value.size===0},{default:i(()=>e[12]||(e[12]=[v("주문하기")])),_:1},8,["disabled"]),n(r,{to:"/"},{default:i(()=>[n(h,null,{default:i(()=>e[13]||(e[13]=[v("쇼핑 계속하기")])),_:1})]),_:1})])],64)),n(M)])}}},me=V(ce,[["__scopeId","data-v-4d567464"]]);export{me as default};
