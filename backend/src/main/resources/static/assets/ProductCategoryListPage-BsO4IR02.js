import{_ as w,r as c,i as B,s as R,j as q,I as D,o as r,c as u,a as s,t as i,F,n as V,b as v,w as C,p as S,C as z,k as A,H as E,x as M,g as m,f as T,q as Y,d as j}from"./index-0xaR3VCP.js";import{b as H}from"./format-B6-WTpBz.js";import{L as K,S as G,C as J}from"./CartButton-CGnb9VlP.js";import{P as O}from"./Pagination-BCSqXmJG.js";const Q={class:"product-list-page"},U={key:0,class:"text-center py-5"},W={key:1,class:"text-center py-5"},X={key:2},Z={class:"product-grid"},ee={class:"product-image"},se=["src"],ae={class:"product-info"},te={class:"product-name"},oe={class:"text-decoration-line-through"},ie={class:"product-price",style:{color:"var(--primary-color)"}},ne={class:"product-actions"},le={__name:"ProductCategoryListPage",setup(ce){const n=c([]),h=c(0),y=c(0),l=c(0),f=c(!1),L=c(""),N=c(20),g=E(),p=M(),d=B(),I=R(()=>g.params.id),_=async()=>{f.value=!0;try{const a=await m.get(`/api/v1/products/categories/${I.value}?page=${l.value}&size=${N.value}`);n.value=a.data.products,h.value=a.data.totalPages,y.value=a.data.totalElements,l.value=a.data.currentPage,L.value=a.data.categoryName}catch(a){console.error("Failed to fetch products:",a),n.value=[]}finally{f.value=!1}};q(()=>{const a=Number(g.query.page)||0;l.value=a,_()}),D(()=>g.params.id,(a,e)=>{l.value=0,_()});const P=a=>{l.value=a-1,p.push({query:{...g.query,page:l.value}}),_()},x=async a=>{try{await m.post(`/api/v1/saved/${a}`);const e=n.value.find(o=>o.id===a);e&&(e.isSaved=!e.isSaved,e.isSaved?d.success("찜 목록에 저장 완료!"):d.info("찜 목록에서 삭제 완료!"))}catch(e){console.log("handleSave() err:",e),e.status===401&&p.push("/login")}},$=async a=>{try{await m.post(`/api/v1/liked/${a}`);const e=n.value.find(o=>o.id===a);e&&(e.isLiked=!e.isLiked,e.isLiked?d.success("좋아요 목록에 저장 완료!"):d.info("좋아요 목록에서 삭제 완료!"))}catch(e){console.log("handleLike() err:",e),e.status===401&&p.push("/login")}},b=async a=>{try{await m.post(`/api/v1/cart/${a}`);const e=n.value.find(o=>o.id===a);e&&(e.isInCart=!e.isInCart,e.isInCart?d.success("장바구니 목록에 저장 완료!"):d.info("장바구니 목록에서 삭제 완료!"))}catch(e){console.log("handleCartAdd() err:",e),e.status===401&&p.push("/login")}};return(a,e)=>{const o=T("RouterLink");return r(),u("div",Q,[s("h3",null,i(L.value)+" 관련도서",1),s("h4",null,"상품 ("+i(y.value.toLocaleString())+")",1),f.value?(r(),u("div",U,e[0]||(e[0]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):n.value.length?(r(),u("div",X,[s("div",Z,[(r(!0),u(F,null,V(n.value,t=>(r(),u("div",{class:"product-item",key:t.id},[s("div",ee,[v(o,{to:`/products/${t.id}`},{default:C(()=>[s("img",{src:S(Y)(t.thumbnail.fileName),alt:"상품 이미지"},null,8,se)]),_:2},1032,["to"])]),s("div",ae,[s("span",te,[v(o,{to:`/products/${t.id}`,class:"link-dark"},{default:C(()=>[j(i(t.name),1)]),_:2},1032,["to"])]),s("div",null,[s("small",null,i(t.authorNames)+" 저",1)]),s("div",null,[s("small",null,i(t.publisherName),1)]),s("div",null,[s("small",null,i(S(H)(t.publishedDate)),1)]),s("div",null,[s("small",oe,i(t.price.toLocaleString())+"원",1),s("span",ie,i((t.price-t.price*t.discountRate/100).toLocaleString())+"원",1)]),s("div",null,[s("small",null,"판매량 "+i(t.sold.toLocaleString())+"부",1)])]),s("div",ne,[v(K,{onLike:k=>$(t.id),"is-active":t.isLiked},null,8,["onLike","is-active"]),v(G,{onSave:k=>x(t.id),"is-active":t.isSaved},null,8,["onSave","is-active"]),v(J,{onCart:k=>b(t.id),"is-active":t.isInCart},null,8,["onCart","is-active"])])]))),128))]),h.value>0?(r(),z(O,{key:0,"current-page":l.value+1,"total-pages":h.value,onPageChange:P},null,8,["current-page","total-pages"])):A("",!0)])):(r(),u("div",W,e[1]||(e[1]=[s("div",{class:"empty-state"},[s("i",{class:"bi bi-book",style:{"font-size":"4rem"}}),s("h3",{class:"mt-4"},"상품이 없습니다"),s("p",{class:"text-muted"},"해당하는 상품을 찾을 수 없습니다.")],-1)])))])}}},ge=w(le,[["__scopeId","data-v-21f781cc"]]);export{ge as default};
