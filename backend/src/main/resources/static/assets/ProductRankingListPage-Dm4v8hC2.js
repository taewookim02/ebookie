import{_ as F,r as d,s as M,p as Q,D as T,k as C,o as n,c as i,m as h,a as t,v as Y,E as j,F as G,y as K,t as u,b as p,w as N,q as b,G as H,C as J,z as O,g as m,f as W,d as w}from"./index-CSlCrRMK.js";import{g as X}from"./imgPath-CG_qeXUq.js";import{A as Z}from"./ActionButton-E0kC5jL-.js";import{C as ee,L as se,S as te}from"./CartButton-BNyizJxS.js";import{b as ae}from"./format-B6-WTpBz.js";import{P as oe}from"./Pagination-DnPXZ79Z.js";const ne={class:"product-list-page"},ie={key:0},le={key:1},re={key:2},ue={class:"d-flex justify-content-end mb-3"},ce={key:3,class:"text-center py-5"},de={key:4,class:"text-center py-5"},ve={key:5},ge={class:"product-rank"},pe={class:"product-image"},he=["src"],me={class:"product-info"},fe={class:"product-name"},ye={class:"text-decoration-line-through"},_e={class:"product-price"},ke={key:0,class:"badge text-bg-danger"},Le={class:"product-actions"},Se={__name:"ProductRankingListPage",setup(Ce){const v=d([]),y=d(0),I=d(0),_=d(0),k=d(!1),l=d(20),L=J(),c=O(),g=M(),f=d(L.query),r=d(new URLSearchParams(f.value).toString());console.log(r.value);const P=async()=>{k.value=!0;try{const s=await m.get(`/api/v1/products?${r.value}&size=${l.value}`);v.value=s.data.products,y.value=s.data.totalPages,I.value=s.data.totalElements,_.value=s.data.currentPage}catch(s){console.error("Failed to fetch products:",s),v.value=[]}finally{k.value=!1}};Q(()=>{const s=Number(L.query.size);s&&(l.value=s),P()}),T(L,(s,e)=>{f.value=s.query,r.value=new URLSearchParams(f.value).toString();const o=Number(s.query.size);o&&o!==l.value&&(l.value=o),P()},{deep:!0});const R=C(()=>r.value.includes("sold")&&r.value.includes("desc")),x=C(()=>r.value.includes("publishedDate")&&r.value.includes("desc")),$=C(()=>r.value.includes("discountRate")&&r.value.includes("desc")),B=async s=>{try{await m.post(`/api/v1/saved/${s}`);const e=v.value.find(o=>o.id===s);e&&(e.isSaved=!e.isSaved,e.isSaved?g.success("찜 목록에 저장 완료!"):g.info("찜 목록에서 삭제 완료!"))}catch(e){console.log("handleSave() err:",e),e.status===401&&c.push("/login")}},z=async s=>{try{await m.post(`/api/v1/liked/${s}`);const e=v.value.find(o=>o.id===s);e&&(e.isLiked=!e.isLiked,e.isLiked?g.success("좋아요 목록에 저장 완료!"):g.info("좋아요 목록에서 삭제 완료!"))}catch(e){console.log("handleLike() err:",e),e.status===401&&c.push("/login")}},q=async s=>{try{await m.post(`/api/v1/cart/${s}`);const e=v.value.find(o=>o.id===s);e&&(e.isInCart=!e.isInCart,e.isInCart?g.success("장바구니 목록에 저장 완료!"):g.info("장바구니 목록에서 삭제 완료!"))}catch(e){console.log("handleCartAdd() err:",e),e.status===401&&c.push("/login")}},D=async s=>{try{console.log("handleBuy");const e=[s],a=(await m.post("/api/v1/orders",{productIds:e})).data.orderId;c.push(`/orders/${a}`)}catch(e){console.log("handleBuy() err:",e),e.status===401&&c.push("/login")}},A=s=>{const e=new URLSearchParams(f.value);return e.set("page",s),e.set("size",l.value),e.toString()},U=s=>{c.push(`/products?${A(s-1)}`)},V=()=>{const s=c.currentRoute.value.query;c.push({path:"/products",query:{page:"0",size:l.value,sort:s.sort||"publishedDate,desc"}})};return(s,e)=>{const o=W("RouterLink");return n(),i("div",ne,[R.value?(n(),i("h1",ie,"베스트셀러 순위")):h("",!0),x.value?(n(),i("h1",le,"신상품 순위")):h("",!0),$.value?(n(),i("h1",re,"세일 순위")):h("",!0),t("div",ue,[Y(t("select",{class:"form-select",style:{width:"auto"},"onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a),onChange:V},e[1]||(e[1]=[t("option",{value:"10"},"10개씩 보기",-1),t("option",{value:"20"},"20개씩 보기",-1),t("option",{value:"50"},"50개씩 보기",-1)]),544),[[j,l.value]])]),k.value?(n(),i("div",ce,e[2]||(e[2]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):v.value.length?(n(),i("div",ve,[(n(!0),i(G,null,K(v.value,(a,E)=>(n(),i("div",{class:"product-item",key:a.id},[t("div",ge,[t("span",null,u(_.value*l.value+E+1),1)]),t("div",pe,[p(o,{to:`/products/${a.id}`},{default:N(()=>[t("img",{src:b(X)(a.thumbnail.fileName),alt:"상품 이미지"},null,8,he)]),_:2},1032,["to"])]),t("div",me,[t("span",fe,[p(o,{to:`/products/${a.id}`,class:"link-dark"},{default:N(()=>[w(u(a.name),1)]),_:2},1032,["to"])]),t("div",null,[t("span",null,u(a.authorNames)+" 저",1),e[4]||(e[4]=t("small",null,"|",-1)),t("span",null,u(a.publisherName),1),e[5]||(e[5]=t("small",null,"|",-1)),t("span",null,u(b(ae)(a.publishedDate)),1)]),t("div",null,[t("small",ye,u(a.price.toLocaleString())+"원",1),t("span",_e,u((a.price-a.price*a.discountRate/100).toLocaleString())+"원",1),a.discountRate?(n(),i("span",ke,u(a.discountRate)+"%",1)):h("",!0)]),t("div",null,[t("span",null,"판매량 "+u(a.sold.toLocaleString())+"부",1)])]),t("div",Le,[p(ee,{onCart:S=>q(a.id),"is-active":a.isInCart},null,8,["onCart","is-active"]),p(se,{onLike:S=>z(a.id),"is-active":a.isLiked},null,8,["onLike","is-active"]),p(te,{onSave:S=>B(a.id),"is-active":a.isSaved},null,8,["onSave","is-active"]),p(Z,{onAction:S=>D(a.id)},{default:N(()=>e[6]||(e[6]=[w("구매하기")])),_:2},1032,["onAction"])])]))),128))])):(n(),i("div",de,e[3]||(e[3]=[t("div",{class:"empty-state"},[t("i",{class:"bi bi-book",style:{"font-size":"4rem"}}),t("h3",{class:"mt-4"},"상품이 없습니다"),t("p",{class:"text-muted"},"해당하는 상품을 찾을 수 없습니다.")],-1)]))),y.value>0?(n(),H(oe,{key:6,"current-page":_.value+1,"total-pages":y.value,onPageChange:U},null,8,["current-page","total-pages"])):h("",!0)])}}},xe=F(Se,[["__scopeId","data-v-8655fee9"]]);export{xe as default};
