import{_ as V,r as _,a as B,s as m,o as i,c as d,b as t,l as F,v as N,d as n,w as u,A as h,k,F as x,n as E,t as g,p as y,x as T,h as f,g as q,e as v,q as M}from"./index-Ct8V6wF8.js";import{D as U}from"./DeliveryAndRefundSection-DRLGzw03.js";import{O as j}from"./OrderPricesSection-BPJGfFwL.js";import{f as A}from"./format-B6-WTpBz.js";const G={class:"cart-container"},H={class:"cart"},J={class:"cart__control"},K={colspan:"2"},Q={class:"table cart__table"},W={key:0,class:"text-center"},X={class:"text-center"},Y=["checked","onChange"],Z=["src"],ee={class:"text-muted prices"},te={class:"text-cross mr-2"},le={class:"fw-bold"},ae={class:"td-action"},se={key:1},oe={key:0},re={colspan:"7",class:"text-end fw-bold"},ne={class:"orders__action"},ce={__name:"CartPage",setup(ue){const s=_([]),c=B(),a=_(new Set),p=_(!0),b=T(),I=m(()=>s.value.filter(l=>a.value.has(l.productId)).reduce((l,e)=>l+e.originalPrice,0)),D=m(()=>s.value.filter(l=>a.value.has(l.productId)).reduce((l,e)=>{const r=e.originalPrice*e.discountRatePercentage/100;return l+r},0)),w=m(()=>s.value.filter(l=>a.value.has(l.productId)).reduce((l,e)=>{const r=e.originalPrice-e.originalPrice*e.discountRatePercentage/100;return l+r},0)),S=m(()=>s.value.length===0);(async()=>{try{const l=await f.get("/api/v1/cart");s.value=l.data,a.value=new Set(s.value.map(e=>e.productId))}catch(l){console.log("fetchCartProducts() err:",l)}})();const $=async l=>{try{const e=await f.delete(`/api/v1/cart/${l}`);s.value=s.value.filter(r=>r.productId!==l),a.value.delete(l),c.info("장바구니 목록에서 삭제 완료!")}catch(e){console.log("handleDeleteClick() err:",e),c.error("삭제 중 에러 발생!")}},R=()=>{p.value?a.value=new Set(s.value.map(l=>l.productId)):a.value.clear()},z=l=>{a.value.has(l)?(a.value.delete(l),p.value=!1):(a.value.add(l),p.value=a.value.size===s.value.length)},L=async()=>{if(a.value.size===0){c.warning("삭제할 상품을 선택해주세요");return}try{const l=Array.from(a.value);await f.delete("/api/v1/cart/bulk",{data:{productIds:l}}),s.value=s.value.filter(e=>!a.value.has(e.productId)),a.value.clear(),p.value=!1,c.info(`${l.length}개 상품이 장바구니 목록에서 삭제되었습니다`)}catch(l){console.log("handleCheckedDelete() err:",l),c.error("선택한 상품 삭제 중 에러가 발생했습니다!")}},C=async()=>{try{const l=Array.from(a.value),r=(await f.post("/api/v1/orders",{productIds:l})).data.id;c.success("주문 생성 성공!"),b.push(`/orders/${r}`)}catch{c.error("주문 생성 실패!")}},O=async l=>{console.log("구매하기",l);try{const r=(await f.post("/api/v1/orders",{productIds:[l]})).data.id;c.success("주문 생성 성공!"),b.push(`/orders/${r}`)}catch{c.error("주문 생성 실패!")}};return(l,e)=>{const r=q("RouterLink");return i(),d("div",G,[t("section",H,[e[11]||(e[11]=t("h1",{class:"mb-4"},"장바구니",-1)),t("div",J,[t("div",null,[F(t("input",{type:"checkbox",name:"all",id:"all","onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),onChange:R},null,544),[[N,p.value]])]),t("div",K,[e[3]||(e[3]=t("label",{for:"all"},"전체선택",-1)),n(h,{onAction:L,disabled:a.value.size===0,class:"btn-select"},{default:u(()=>e[1]||(e[1]=[v(" 선택삭제 ")])),_:1},8,["disabled"]),n(h,{onAction:C,disabled:a.value.size===0,class:"btn-select"},{default:u(()=>e[2]||(e[2]=[v(" 선택주문 ")])),_:1},8,["disabled"])])]),t("table",Q,[e[10]||(e[10]=t("colgroup",null,[t("col",{width:"5%"}),t("col",{width:"10%"}),t("col",{width:"50%"}),t("col",{width:"5%"}),t("col",{width:"10%"}),t("col",{width:"20%"})],-1)),t("thead",null,[s.value&&s.value.length>0?(i(),d("tr",W,e[4]||(e[4]=[t("th",null,null,-1),t("th",{colspan:"2"},"상품정보",-1),t("th",null,"수량",-1),t("th",null,"상품금액",-1),t("th",null,"배송정보",-1),t("th",null,"주문",-1)]))):k("",!0)]),t("tbody",null,[s.value&&s.value.length>0?(i(!0),d(x,{key:0},E(s.value,o=>(i(),d("tr",null,[t("td",X,[t("input",{type:"checkbox",checked:a.value.has(o.productId),onChange:P=>z(o.productId)},null,40,Y)]),t("td",null,[n(r,{to:`/products/${o.productId}`},{default:u(()=>[t("img",{class:"img-product",src:y(M)(o.thumbnail),alt:"상품 이미지"},null,8,Z)]),_:2},1032,["to"])]),t("td",null,[n(r,{to:`/products/${o.productId}`,class:"link-dark"},{default:u(()=>[v(g(o.name),1)]),_:2},1032,["to"]),t("div",ee,[t("small",te,g(o.originalPrice.toLocaleString()),1),t("span",null,g(y(A)(o.originalPrice,o.discountRatePercentage))+"원",1)])]),e[7]||(e[7]=t("td",null," 1 ",-1)),t("td",le,g(y(A)(o.originalPrice,o.discountRatePercentage))+"원 ",1),e[8]||(e[8]=t("td",null,"구매 후 바로 다운로드",-1)),t("td",ae,[n(h,{class:"w-100",onAction:P=>$(o.productId)},{default:u(()=>e[5]||(e[5]=[v("삭제")])),_:2},1032,["onAction"]),n(h,{class:"w-100",onAction:P=>O(o.productId)},{default:u(()=>e[6]||(e[6]=[v("주문하기 ")])),_:2},1032,["onAction"])])]))),256)):(i(),d("tr",se,e[9]||(e[9]=[t("td",{colspan:"6",class:"td-empty text-muted"},[t("small",null,"장바구니가 비었습니다.")],-1)])))]),s.value&&s.value.length>0?(i(),d("tfoot",oe,[t("tr",null,[t("td",re,"합계: "+g(w.value.toLocaleString())+"원",1)])])):k("",!0)])]),S.value?k("",!0):(i(),d(x,{key:0},[n(j,{"total-original-price":I.value,"total-discount-amount":D.value,"total-final-price":w.value},null,8,["total-original-price","total-discount-amount","total-final-price"]),t("section",ne,[n(h,{onAction:C,disabled:a.value.size===0},{default:u(()=>e[12]||(e[12]=[v("주문하기")])),_:1},8,["disabled"]),n(r,{to:"/"},{default:u(()=>[n(h,null,{default:u(()=>e[13]||(e[13]=[v("쇼핑 계속하기")])),_:1})]),_:1})])],64)),n(U)])}}},ge=V(ce,[["__scopeId","data-v-1a15075d"]]);export{ge as default};
